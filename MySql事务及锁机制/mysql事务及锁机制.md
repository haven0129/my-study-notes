# mysql事务及锁机制

## 事务特点

### A（原子性）:事务里的一系列操作，要么都执行，要么都不执行

### C（一致性）：从一个一致性状态到另一个一致性状态（比如转账，不管转多少次，两个账户总金额是一样的）

由原子性，隔离性，持久性最终来保证事务的一致性

### I（隔离性）：事务与事务之间互不干涉，跟串行执行是一样的结果

### D（持久性）：每次事务操作都是持久化的，即使系统挂了重启后还是事务执行后的结果（存到磁盘）

## 数据库系统技术

### 并发控制技术

- 保证事务的隔离性
- 保证事务的一致性

### 日志恢复技术

- 保证事务的原子性
- 保证事务的持久性
- 保证事务的一致性

## 事务实现原理

### redo log实现持久性

### undo log实现原子性

### 读写锁 + mvcc实现隔离性

### 原子性 + 持久性 + 隔离性 实现一致性

## mysql的隔离级别

### 读未提交（READ UNCOMMITTED）

- 脏读
- 不可重复读
- 幻读

### 读已提交(READ COMMITTED)

- 不可重复读
- 幻读

### 可重复读(REPEATABLE READ)默认

- 幻读

### 串行化(SERIALIZABLE)

## mysql在innoBD中锁

### 分类

- 共享锁：数据只读，读取锁定
- 排他锁：不能读取，写入锁定

### 粒度

- 行（默认）
- 表

## mysql系统架构

### 客户端

- 可视化工具
- jdbc
- cli
- 等等。。。

### mysql服务端

- 连接器：控制用户的连接
- 分析器：词法分析，语法分析
- 优化器：优化sql语句，规定执行流程
- 执行器：sql语句的实际执行组件

### 存储引擎

- InnoDB磁盘(mysql默认)
- MyISAM磁盘
- memory内存

## bin log

## redo log、undo log

undo log是逻辑日志，可以理解为：
当insert一条语句的时候，undo log中会记录一条对应的delete语句。
当delete一条语句的时候，undo log中会记录一条对应的insert语句。
当update一条语句的时候，undo log中会记录一条相反的update语句。
redo log是物理日志:在事务提交前，先持久化到redo log，然后再持久化到磁盘。

*XMind - Trial Version*